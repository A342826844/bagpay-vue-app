<!DOCTYPE html>
<html lang="en" class="html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1, minimum-scale=1, user-scalable=no,viewport-fit=cover">
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <script src="./js/swiper.min.js"></script>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/swiper.min.css">
    <title>Bag Pay 注册</title>
    
    <script src="https://lib.baomitu.com/vue/2.6.11/vue.js"></script>
    <script src="https://lib.baomitu.com/axios/0.21.0/axios.min.js"></script>
    <script src="./js/lang.js"></script>
</head>
<body class="body_container">
    <div id="app">
        <div class="logo_box">
            <img src="./img/logo.png" alt="" class="logo_img">
        </div>
    
        <div class="white_bg_reg">
            <div class="register-flex">
                <h4 class="register-head">创建账号</h4>
                <span class="primary-color">邮箱注册</span>
            </div>
            <form class="form">
                <div class="register-flex input-item">
                    <input class="register-input" value="" placeholder="昵称" />
                    <span></span>
                </div>
                <div class="register-flex input-item">
                    <input class="register-input" value="" placeholder="手机号" />
                    <span class="primary-color">+ 86</span>
                </div>
                <div class="register-flex input-item">
                    <input class="register-input" value="" placeholder="图形码" />
                    <img class="form-imgcode" src="" />
                </div>
                <div class="register-flex input-item">
                    <input class="register-input" value="" placeholder="验证码" />
                    <span class="primary-color">发送</span>
                </div>
                <div class="register-flex input-item">
                    <input class="register-input" value="" placeholder="登录密码" />
                    <span></span>
                </div>
                <div class="register-arg">注册及同意《<a class="primary-color" href="/register/protocol.index">BagPay用户协议</a>》</div>
                <input class="form-submit primary-bg" type="submit" value="创建" />
            </form>
        </div>
    </div>
    
    <script>
        var browser = {
            versions: function () {
                var u = navigator.userAgent, app = navigator.appVersion;
                return {//移动终端浏览器版本信息
                trident: u.indexOf('Trident') > -1, //IE内核
                presto: u.indexOf('Presto') > -1, //opera内核
                webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
                gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
                mobile: !!u.match(/AppleWebKit.*Mobile/i) || !!u.match(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/), //是否为移动终端
                ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
                iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者QQHD浏览器
                iPad: u.indexOf('iPad') > -1, //是否iPad
                webApp: u.indexOf('Safari') == -1 //是否web应该程序，没有头部与底部
                };
            } (),
            // language: (navigator.browserLanguage || navigator.language).toLowerCase()
        }

        new Vue({
            el:"#app",
            data: {
                title: 'Bag Pay 下载',
                loading1: false,
                loading2: false,
                type: 'Android IOS',
                langMessage: langMessage,
                lang: 'en-us'
            },
            created() {
                var language = navigator.language.toLowerCase();
                var getQueryUrl = (query) => {
                    var querys = `${query}`.split('&');
                    var res = {};
                    querys.forEach(function(item) {
                        var values = item.split('=');
                        res[values[0]] = values[1];
                    });
                    return res;
                };
                var query = getQueryUrl(location.search.slice(1));
                if (query.lang && Object.keys(langMessage).indexOf(query.lang) !== -1) {
                    this.lang = query.lang;
                } else if (language.indexOf('zh') !== -1) {
                    this.lang = 'zh-CN';
                } else {
                    this.lang = 'en-us';
                }
            },
            mounted() {
                this.$nextTick(() => {
                    var mySwiper = new Swiper ('.swiper-container', {
                        autoplay: true,
                        pagination: {
                            el: '.swiper-pagination',
                        },

                    }) 
                })
            },
            methods: {
                androidDown() {
                    if (this.loading1) return;
                    this.loading1 = true;
                    this.getUrl('android').then(res => {
                        this.loading1 = false;
                        this.downloadHandle(res.url);
                    }).catch(() => {
                        this.loading1 = false;
                        this.downloadHandle('http://x100.oss-ap-southeast-1.aliyuncs.com/app/bagpay.apk');
                    })
                },
                getUrl(channel) {
                            /* txt
                    channel: [string] 渠道 ios,android
                    version: [string] 版本
                    build: [string] 构建号 */
                    return axios.get('https://api.bagpay.io/app/version/check?channel='+channel).then(function(res) {
                        return res.data.data;
                    });
                },
                iosDown() {
                    // console.log(browser.versions);
                    if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
                        if (this.loading2) return;
                        this.loading2 = true;
                        this.getUrl('ios').then(res => {
                            window.location.href = res.url;
                        }).catch(() => {
                            this.loading2 = false;
                        })
                    } else {
                    }
                },
                downloadHandle(url) {
                    let a = document.createElement('a');
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.download;
                    a.href = url;
                    a.click();
                    document.body.removeChild(a);
                }
            }
        })
    </script>
</body>
</html>